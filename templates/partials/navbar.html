<!-- templates/partials/navbar.html -->
{% load static %}
{% load nav_CDB_links_loader %}

{% external_link_from_static "Central_Database_Gateway.txt" as central_database_gateway_link %}


{% if request.path|slice:":9" == "/project/" %}
    <!-- ðŸ”¹ Project Navbar (Deep Ash) -->
    <nav class="navbar navbar-expand-sm navbar-dark" style="background-color: #2f1658ff;">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarProject">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarProject">
            <ul class="navbar-nav mr-auto">
                {% if user.is_authenticated %}
                                <li class="nav-item">
                                    <a class="nav-link" href="{% url 'Project_App_Home:project_home_page' %}">
                                        <i class="fas fa-project-diagram"></i> P_Home
                                    </a>
                                </li>                    {% if request.user.is_superuser or request.user.user_group.user_group_type == "Editor" %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_Allocation:allocation_page' %}">
                            <i class="fas fa-tasks"></i> P_Allocation
                        </a>
                    </li>
                    {% endif %}
                    {% if request.user.is_superuser or request.user.user_group.user_group_type in "Editor View History and Status only" %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_Status:status_page' %}">
                            <i class="fas fa-info-circle"></i> P_Status
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_History:history_page' %}">
                            <i class="fas fa-history"></i> P_History
                        </a>
                    </li>
                    {% if request.user.is_superuser or request.user.user_group.user_group_type == "Editor" %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_Modification:modification_menu' %}">
                            <i class="fas fa-edit"></i> P_Modification
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_Cancellation:cancellation' %}">
                            <i class="fas fa-ban"></i> P_Cancellation
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_Entry:entry_page' %}">
                            <i class="fas fa-plus-circle"></i> P_Entry
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'Project_App_ProjectWiseBalance:project_list' %}">
                            <i class="fas fa-plus-circle"></i> P_Project-Wise Balance
                        </a>
                    </li>
                    {% endif %}
                {% endif %}
            </ul>

            <!-- ðŸ”¹ Same User Dropdown -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    {# If file read fails, central_database_gateway_link is empty string -> use "#" to avoid broken href #}
                    <a class="nav-link text-warning" href="{{ central_database_gateway_link|default:'#' }}" target="_blank" rel="noopener noreferrer">Central_Database_Gateway</a>
                </li>
                {% if user.is_authenticated %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown">
                            <i class="fas fa-user-circle"></i> @{{ user.username }}
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            {% if request.user.is_superuser %}
                                <a class="dropdown-item text-primary" href="{% url 'App_Admin_Panel:admin_panel_home' %}">
                                    <i class="fas fa-tools"></i> <strong>Admin Panel</strong>
                                </a>
                                <div class="dropdown-divider"></div>
                            {% endif %}
                            <a class="dropdown-item text-danger" href="{% url 'App_Login:logout' %}">
                                <i class="fas fa-sign-out-alt"></i> <strong>Logout</strong>
                            </a>
                        </div>
                    </li>
                {% else %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'login' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Login:login' %}">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </nav>
{% else %}
    <!-- ðŸ”¸ Default Navbar -->
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarDefault">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarDefault">
            <ul class="navbar-nav mr-auto">
                {% if user.is_authenticated %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'home_page' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Home:home_page' %}">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </li>
                    {% if request.user.is_superuser or request.user.user_group.user_group_type == "Editor" %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'allocation_page' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Allocation:allocation_page' %}">
                            <i class="fas fa-tasks"></i> Allocation
                        </a>
                    </li>
                    {% endif %}
                    {% if request.user.is_superuser or request.user.user_group.user_group_type in "Editor View History and Status only" %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'status_page' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Status:status_page' %}">
                            <i class="fas fa-info-circle"></i> Status
                        </a>
                    </li>
                    {% endif %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'history_page' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_History:history_page' %}">
                            <i class="fas fa-history"></i> History
                        </a>
                    </li>
                    {% if request.user.is_superuser or request.user.user_group.user_group_type == "Editor" %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'modification_menu' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Modification:modification_menu' %}">
                            <i class="fas fa-edit"></i> Modification
                        </a>
                    </li>
                    {% endif %}
                    {% if request.user.is_superuser or request.user.user_group.user_group_type == "Editor" %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'cancellation' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Cancellation:cancellation' %}">
                            <i class="fas fa-ban"></i> Cancellation
                        </a>
                    </li>
                    {% endif %}
                    {% if request.user.is_superuser or request.user.user_group.user_group_type == "Editor" %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'entry_page' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Entry:entry_page' %}">
                            <i class="fas fa-plus-circle"></i> Entry
                        </a>
                    </li>
                    {% endif %}
                {% endif %}
            </ul>

            <!-- ðŸ”¸ Same User Dropdown -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link text-warning" href="{{ central_database_gateway_link|default:'#' }}" target="_blank" rel="noopener noreferrer">Central_Database_Gateway</a>
                </li>
                {% if user.is_authenticated %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown">
                            <i class="fas fa-user-circle"></i> @{{ user.username }}
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            {% if request.user.is_superuser %}
                                <a class="dropdown-item text-primary" href="{% url 'App_Admin_Panel:admin_panel_home' %}">
                                    <i class="fas fa-tools"></i> <strong>Admin Panel</strong>
                                </a>
                                <div class="dropdown-divider"></div>
                            {% endif %}
                            <a class="dropdown-item text-danger" href="{% url 'App_Login:logout' %}">
                                <i class="fas fa-sign-out-alt"></i> <strong>Logout</strong>
                            </a>
                        </div>
                    </li>
                {% else %}
                    <li class="nav-item {% if request.resolver_match.url_name == 'login' %}active{% endif %}">
                        <a class="nav-link" href="{% url 'App_Login:login' %}">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </nav>
{% endif %}
